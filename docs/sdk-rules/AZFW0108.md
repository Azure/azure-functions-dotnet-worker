# AZFW0108: Extension bundle not restored prior to build

| Item | Value |
| - | - |
| **Rule ID** | AZFW0108 |
| **Category** | Sdk |
| **Severity** | Warning |

## Cause

This SDK warning occurs when a project using `Azure.Functions.Sdk` is built without the extension bundle post-restore hook being invoked. The post-restore hook is only ran when the function project is directly restored. Restoring a solution file or a traversal project will not invoke the post-restore hook. 

When the post-restore hook is not successfully ran, the functions SDK will try to run the hook before build. However, since the post-restore hook performs another nuget restore itself, running as part of build (and not restore) may cause issues depending on the build environment. It is strongly recommended to follow the steps [here](#how-to-fix-violations) to ensure the post-restore hook runs as part of `dotnet restore`.

## Rule Description

The extension bundle is a payload that is deployed along-side a function application, which contains the extensions needed by the functions runtime to enable the function app's triggers and bindings.

## How to Fix

### Option 1: Restore function csproj directly

The post-restore hook will be ran when the functions project is restored directly.

``` shell
dotnet restore MyFunctionApp.csproj
```

### Option 2: Add post-restore hook for restore target.

Include the following target in the existing restore project (or solution). Do not add to the function app project, but to what project `dotnet restore` is ran for.

``` xml
<Target Name="_FunctionsPostRestore" AfterTargets="Restore">
  <MSBuild Projects="@(ProjectReference)" Targets="GenerateFunctionsExtensionProject"
    SkipNonexistentProjects="true" SkipNonexistentTargets="true" />
</Target>
```

For solutions, add the above target to `Directory.Solution.targets` next to your solution file.

## When to Suppress Warnings

Suppression is not recommended. Follow the steps [here](#how-to-fix-violations) to fix the warning.
