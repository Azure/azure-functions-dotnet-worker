parameters:
  - name: Projects
    type: object
    default: []
  - name: ExtensionProjectName
    type: string
    default: ''

jobs:

- job: BuildArtifacts
  displayName: Build artifacts

  templateContext:
    outputParentDirectory: $(Build.ArtifactStagingDirectory)
    outputs:
    - output: pipelineArtifact
      displayName: Publish nuget packages
      path: $(Build.ArtifactStagingDirectory)/NugetPackages
      artifact: NugetPackages

  pool:
    name: 1es-pool-azfunc
    image: 1es-ubuntu-22.04
    os: linux

  variables:
    ${{ if and(not(contains(variables['Build.SourceBranch'], '/release/')), not(startsWith(variables['Build.SourceBranch'], 'refs/tags'))) }}:
      buildNumberTemp: $(Build.BuildNumber)
    buildNumber: $[variables.buildNumberTemp]

  steps:
  - template: /eng/ci/templates/steps/install-dotnet.yml@self

  - ${{ if ne(parameters.ExtensionProjectName, '') }}:
    - template: /eng/ci/templates/steps/build-extension-project.yml@self
      parameters:
        ExtensionProjectName: ${{ parameters.ExtensionProjectName }}

  - ${{ if not(eq(length(parameters.Projects), 0)) }}:
    - ${{ each Project in parameters.Projects }}:
      - template: /eng/ci/templates/steps/build-extension-project.yml@self
        parameters:
          ExtensionProjectName: ${{ Project }}
