parameters:
- name: project
  type: string
  default: src/WebJobs.Script.SiteExtension/WebJobs.Script.SiteExtension.csproj

steps:
- task: DotNetCoreCLI@2
  displayName: Restore site extension
  inputs:
    command: custom
    custom: restore
    projects: ${{ parameters.project }}
    arguments: '-v m -p:PublishReadyToRun=true -bl:$(log_dir)/site_ext.restore.binlog'

- task: DotNetCoreCLI@2
  displayName: Publish site extension (net6)
  inputs:
    command: custom
    custom: publish
    publishWebProjects: false # we use our own publish logic
    zipAfterPublish: false # we use our own zip logic
    projects: ${{ parameters.project }}
    arguments: '-v m -c release -f net6.0 --no-restore -p:MinorVersionPrefix=6 -p:ZipArtifactsPath=$(Build.ArtifactStagingDirectory) -bl:$(log_dir)/site_ext_net6.publish.binlog'

- task: DotNetCoreCLI@2
  displayName: Publish site extension (net8)
  inputs:
    command: custom
    custom: publish
    publishWebProjects: false # we use our own publish logic
    zipAfterPublish: false # we use our own zip logic
    projects: ${{ parameters.project }}
    arguments: '-v m -c release -f net8.0 --no-restore -p:MinorVersionPrefix=8 -p:ZipArtifactsPath=$(Build.ArtifactStagingDirectory) -bl:$(log_dir)/site_ext_net8.publish.binlog'
