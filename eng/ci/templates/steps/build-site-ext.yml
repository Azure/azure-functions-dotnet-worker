parameters:
  - name: project
    type: string
    default: src/WebJobs.Script.SiteExtension/WebJobs.Script.SiteExtension.csproj
  - name: extraBuildArgs
    type: string
    default: ''
  - name: binLogPrefix
    type: string
    default: site_ext

steps:
  - task: DotNetCoreCLI@2
    displayName: Publish site extension
    inputs:
      command: custom
      custom: publish
      publishWebProjects: false # we use our own publish logic
      zipAfterPublish: false # we use our own zip logic
      projects: ${{ parameters.project }}
      arguments: '-v m -c release -f net6.0 -p:MinorVersionPrefix=6 -p:BuildNumber=$(buildNumber) -p:ZipArtifactsPath=$(Build.ArtifactStagingDirectory) -bl:$(log_dir)/${{ parameters.binLogPrefix }}.publish.binlog ${{ parameters.extraBuildArgs }}'

  - task: DotNetCoreCLI@2
    displayName: Publish site extension
    inputs:
      command: custom
      custom: publish
      publishWebProjects: false # we use our own publish logic
      zipAfterPublish: false # we use our own zip logic
      projects: ${{ parameters.project }}
      arguments: '-v m -c release -f net8.0 -p:MinorVersionPrefix=8 -p:BuildNumber=$(buildNumber) -p:ZipArtifactsPath=$(Build.ArtifactStagingDirectory) -bl:$(log_dir)/${{ parameters.binLogPrefix }}.publish.binlog ${{ parameters.extraBuildArgs }}'
