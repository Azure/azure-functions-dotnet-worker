parameters:
  - name: DotnetVersion
    type: string
    default: 'net8'
  - name: UseCoreToolsBuild
    type: string
    default: 'False'
  - name: SkipStorageEmulator
    type: boolean
    default: false
  - name: SkipCosmosDBEmulator
    type: boolean
    default: false
  - name: SkipCoreTools
    type: boolean
    default: false
  - name: SkipBuildOnPack
    type: boolean
    default: false

steps:

- template: /eng/ci/templates/steps/start-emulators.yml@self
  parameters:
    azurite: ${{ not(parameters.SkipStorageEmulator) }}
    cosmos: ${{ not(parameters.SkipCosmosDBEmulator) }}

- task: PowerShell@2
  displayName: 'Setup E2E tests'
  inputs:
    targetType: filePath
    filePath: setup-e2e-tests.ps1
    arguments: >
      -DotnetVersion ${{ parameters.DotnetVersion }}
      -SkipStorageEmulator:true
      -SkipCosmosDBEmulator:true
      -SkipCoreTools:$${{ parameters.SkipCoreTools }}
      -UseCoreToolsBuildFromIntegrationTests:$${{ parameters.UseCoreToolsBuild }}
      -SkipBuildOnPack:$${{ parameters.SkipBuildOnPack }}
    pwsh: true
