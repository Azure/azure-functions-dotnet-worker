using System.Threading.Tasks;
using Microsoft.Azure.Functions.Worker.Sdk.Generators;
using Xunit;
namespace Sdk.Generator.Tests
{
    public class UnitTest1
    {
        const string GeneratedFileName = $"ExtensionStartupRunner.g.cs";
        [Fact]
        public async Task Activities_SimpleFunctionTrigger()
        {
            string code = @"
// <auto-generated/>
using System;
using Microsoft.Azure.Functions.Worker;
namespace MyTestNamespace
{
    internal class Foo
    {
        public void Bar()
        {}
    }
}
".Replace("'", "\"\"");

            string expectedOutput = @"// <auto-generated/>
using System;
using Microsoft.Azure.Functions.Worker;
namespace MyUnitTestNamespace
{
    [AttributeUsage(AttributeTargets.Class)]
    public class ExtensionStartupDataAttribute : Attribute
    {
    }
    [ExtensionStartupData]
    internal sealed class ExtensionStartupTypeInfoProvider
    {
        public void RunStartup(IFunctionsWorkerApplicationBuilder builder)
        {
            new Microsoft.Azure.Functions.Worker.Extensions.Http.MyHttpExtensionStartup().Configure(builder);
        }
    }
}
".Replace("'", "\"");

            await TestHelpers.RunTestAsync<StartupLocatorSourceGenerator>(
                GeneratedFileName,
                code,
                expectedOutput,
                isDurableFunctions: true);
        }
    }
}
